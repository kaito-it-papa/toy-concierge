<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIçŸ¥è‚²ç©å…·ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #fdfbf7; }
    .loader {
      border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%;
      width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="text-gray-700 min-h-screen pb-12">

  <div class="w-full max-w-5xl mx-auto mb-4">
    <div style="position: relative; width: 100%; height: 0; padding-top: 56.2225%; padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 0; margin-bottom: 0.9em; overflow: hidden; border-radius: 8px; will-change: transform;">
      <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
        src="https://www.canva.com/design/DAHAd8J_bm0/YfjgiR1coEIRCh335VZRmg/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen">
      </iframe>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-4">
    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 mb-8">
      <h2 class="text-center text-xl font-bold text-gray-600 mb-6 flex items-center justify-center gap-2">
        <span>ğŸ”</span> ãŠå­æ§˜ã«ã´ã£ãŸã‚Šã®ã€Œå®ç‰©ã€ã‚’æ¢ã™
      </h2>

      <div class="grid grid-cols-2 gap-4 mb-5">
        <div>
          <label class="block text-sm font-bold mb-2 text-blue-600">å¹´é½¢</label>
          <select id="age" class="w-full p-3 bg-blue-50 rounded-xl border-none focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer">
            <option value="0æ­³">0æ­³</option>
            <option value="1æ­³">1æ­³</option>
            <option value="2æ­³">2æ­³</option>
            <option value="3æ­³" selected>3æ­³</option>
            <option value="4æ­³">4æ­³</option>
            <option value="5æ­³">5æ­³</option>
            <option value="6æ­³ä»¥ä¸Š">6æ­³ä»¥ä¸Š</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-bold mb-2 text-blue-600">æ€§åˆ¥</label>
          <select id="gender" class="w-full p-3 bg-blue-50 rounded-xl border-none focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer">
            <option value="ç”·ã®å­">ç”·ã®å­</option>
            <option value="å¥³ã®å­">å¥³ã®å­</option>
            <option value="ã“ã ã‚ã‚‰ãªã„">ã“ã ã‚ã‚‰ãªã„</option>
          </select>
        </div>
      </div>

      <div class="mb-8">
        <label class="block text-sm font-bold mb-2 text-blue-600">ãŠå­æ§˜ã®ç‰¹æ€§ãƒ»å¥½ããªã“ã¨</label>
        <textarea id="traits" rows="3" class="w-full p-3 bg-blue-50 rounded-xl border-none focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä¾‹ï¼šæç«œãŒå¥½ãã€‚é›†ä¸­åŠ›ãŒã‚ã‚‹ã€‚å¤–éŠã³ã‚ˆã‚Šå®¶éŠã³ãŒå¥½ãã€‚"></textarea>
      </div>

      <button onclick="startSearch()" class="w-full bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.02] duration-200 active:scale-95 flex items-center justify-center gap-2">
        <span>AIã«ææ¡ˆã—ã¦ã‚‚ã‚‰ã†</span> ğŸ
      </button>
    </div>

    <div id="loading" class="hidden text-center py-10">
      <div class="loader mb-4"></div>
      <p class="text-blue-500 font-bold animate-pulse">GeminiãŒæœ€é©ãªç©å…·ã‚’é¸ã‚“ã§ã„ã¾ã™...</p>
      <p class="text-xs text-gray-400 mt-2">ï¼ˆ20ã€œ30ç§’ã»ã©ã‹ã‹ã‚Šã¾ã™ï¼‰</p>
    </div>

    <div id="results" class="space-y-6"></div>
  </div>

  <script>
    // â–¼â–¼â–¼ ã“ã“ã«GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â–¼â–¼â–¼
    const API_URL = "https://script.google.com/macros/s/AKfycbzL_VmjCm2bGTwnq80CMlV6pLtYM-HaWG0OeiiEC0e0zo9SgG6ghT96jddzgRCe9m_w/exec";
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    async function startSearch() {
      const age = document.getElementById('age').value;
      const gender = document.getElementById('gender').value;
      const traits = document.getElementById('traits').value;

      if (!traits.trim()) {
        alert("ãŠå­æ§˜ã®ç‰¹æ€§ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      document.getElementById('results').innerHTML = "";
      document.getElementById('loading').classList.remove('hidden');

      // fetchã‚’ä½¿ã£ã¦GASã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹
      try {
        // GASã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¤ã‘ã¦ã‚¢ã‚¯ã‚»ã‚¹
        const url = `${API_URL}?age=${encodeURIComponent(age)}&gender=${encodeURIComponent(gender)}&traits=${encodeURIComponent(traits)}`;
        
        // GASã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¿”ã™ä»•æ§˜ãªã®ã§ã€redirect: 'follow' ã‚’æŒ‡å®š
        const response = await fetch(url, {
          method: "GET",
          headers: { "Content-Type": "text/plain" },
        });

        const data = await response.json();
        
        if (data.error) {
          showError({ message: data.error });
        } else {
          showResults(data);
        }

      } catch (error) {
        showError(error);
      }
    }

    function showResults(data) {
      document.getElementById('loading').classList.add('hidden');
      const container = document.getElementById('results');

      if (!data || data.length === 0) {
        container.innerHTML = `<div class="text-center p-8 bg-white rounded-xl border border-dashed border-gray-300"><p class="text-gray-500">æ¡ä»¶ã«åˆã†å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p></div>`;
        return;
      }

      let html = "";
      data.forEach(item => {
        html += `
          <div class="bg-white rounded-2xl shadow-md overflow-hidden flex flex-col md:flex-row border border-gray-100 hover:shadow-xl transition duration-300 transform hover:-translate-y-1">
            <div class="md:w-1/3 bg-gray-50 flex items-center justify-center p-4">
              <img src="${item.imageUrl}" alt="${item.productName}" class="max-h-48 object-contain mix-blend-multiply">
            </div>
            <div class="p-6 md:w-2/3 flex flex-col justify-between">
              <div>
                <div class="flex items-center gap-2 mb-2"><span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">Keyword: ${item.keyword}</span></div>
                <h3 class="text-lg font-bold text-gray-800 mb-2 leading-tight line-clamp-2">${item.productName}</h3>
                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-sm text-gray-700 mb-4"><span class="font-bold text-orange-500">ğŸ’¡ ãŠã™ã™ã‚ç†ç”±:</span><br>${item.reason}</div>
              </div>
              <div class="flex items-center justify-between mt-2 pt-4 border-t border-gray-100">
                <span class="text-xl font-bold text-red-500">${item.price}</span>
                <a href="${item.itemUrl}" target="_blank" class="bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white font-bold py-2 px-6 rounded-full shadow transition flex items-center gap-1">æ¥½å¤©ã§è¦‹ã‚‹ <span>â†—</span></a>
              </div>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
    }

    function showError(error) {
      document.getElementById('loading').classList.add('hidden');
      alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
      console.error(error);
    }
  </script>
</body>
</html>
