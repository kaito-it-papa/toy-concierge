<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIçŸ¥è‚²ç©å…·ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥</title>

  <link rel="icon" type="image/png" href="favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #fdfbf7; }
    
    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .loader {
      border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%;
      width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="text-gray-700 min-h-screen pb-12">

  <div class="w-full max-w-5xl mx-auto mb-4">
    <div style="position: relative; width: 100%; height: 0; padding-top: 56.2225%;
    padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 0; margin-bottom: 0.9em; overflow: hidden;
    border-radius: 8px; will-change: transform;">
      <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
        src="https://www.canva.com/design/DAHAd8J_bm0/YfjgiR1coEIRCh335VZRmg/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen">
      </iframe>
    </div>
    
    <div class="text-xs text-right text-gray-400 px-2">
      æ•°ä¸‡ç‚¹ã®ä¸­ã‹ã‚‰<a href="https://www.canva.com/design/DAHAd8J_bm0/YfjgiR1coEIRCh335VZRmg/view?utm_content=DAHAd8J_bm0&amp;utm_campaign=designshare&amp;utm_medium=embeds&amp;utm_source=link" target="_blank" rel="noopener" class="hover:underline">ãŠå­æ§˜ã®æ‰èƒ½ã‚’ä¼¸ã°ã™ãŠã‚‚ã¡ã‚ƒã€AIãŒè¦‹ã¤ã‘ã¾ã™</a>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-4">
    
    <div class="sticky top-0 z-50 pt-4 pb-2 -mx-4 px-4 bg-white/95 backdrop-blur-sm shadow-sm transition-all duration-300">
      
      <div class="bg-white p-4 md:p-6 rounded-2xl shadow border border-gray-200">
        
        <h2 class="text-center text-lg font-bold text-gray-600 mb-4 flex items-center justify-center gap-2">
          <span>ğŸ”</span> æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢
        </h2>
  
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div>
            <label class="block text-xs font-bold mb-1 text-blue-600">å¹´é½¢</label>
            <select id="age" class="w-full p-2 bg-blue-50 rounded-lg border-none focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer text-sm">
              <option value="0æ­³">0æ­³</option>
              <option value="1æ­³">1æ­³</option>
              <option value="2æ­³">2æ­³</option>
              <option value="3æ­³" selected>3æ­³</option>
              <option value="4æ­³">4æ­³</option>
              <option value="5æ­³">5æ­³</option>
              <option value="6æ­³ä»¥ä¸Š">6æ­³ä»¥ä¸Š</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-bold mb-1 text-blue-600">æ€§åˆ¥</label>
            <select id="gender" class="w-full p-2 bg-blue-50 rounded-lg border-none focus:outline-none focus:ring-2 focus:ring-blue-400 cursor-pointer text-sm">
              <option value="ç”·ã®å­">ç”·ã®å­</option>
              <option value="å¥³ã®å­">å¥³ã®å­</option>
              <option value="ã“ã ã‚ã‚‰ãªã„">ã“ã ã‚ã‚‰ãªã„</option>
            </select>
          </div>
        </div>
  
        <div class="mb-4">
          <label class="block text-xs font-bold mb-1 text-blue-600">ç‰¹æ€§ãƒ»å¥½ããªã“ã¨</label>
          <textarea id="traits" rows="2" class="w-full p-2 bg-blue-50 rounded-lg border-none focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm" placeholder="ä¾‹ï¼šæç«œãŒå¥½ãã€‚é›†ä¸­åŠ›ãŒã‚ã‚‹ã€‚"></textarea>
        </div>
  
        <button onclick="startSearch()" class="w-full bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 text-white font-bold py-3 rounded-xl shadow-md transform transition hover:scale-[1.01] active:scale-95 flex items-center justify-center gap-2 text-sm">
          <span>AIã«ææ¡ˆã—ã¦ã‚‚ã‚‰ã†</span> ğŸ
        </button>
      </div>
    </div>
    <div id="loading" class="hidden text-center py-10 mt-8">
      <div class="loader mb-4"></div>
      <p class="text-blue-500 font-bold animate-pulse">AIçŸ¥è‚²ç©å…·ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒæœ€é©ãªç©å…·ã‚’é¸ã‚“ã§ã„ã¾ã™...</p>
      <p class="text-xs text-gray-400 mt-2">ï¼ˆ20ã€œ30ç§’ã»ã©ã‹ã‹ã‚Šã¾ã™ï¼‰</p>
    </div>

    <div id="results" class="space-y-6 mt-8">
      </div>
  </div>

  <script>
    // â–¼â–¼â–¼ã€é‡è¦ã€‘ã“ã“ã«ã‚ãªãŸã®GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â–¼â–¼â–¼
    // ä¾‹: "https://script.google.com/macros/s/AKfycbzL_VmjCm2bGTwnq80CMlV6pLtYM-HaWG0OeiiEC0e0zo9SgG6ghT96jddzgRCe9m_w/exec"
    const API_URL = "ã“ã“ã«_GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’_è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"; 
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    async function startSearch() {
      const age = document.getElementById('age').value;
      const gender = document.getElementById('gender').value;
      const traits = document.getElementById('traits').value;

      // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
      if (!traits.trim()) {
        alert("ãŠå­æ§˜ã®ç‰¹æ€§ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\nï¼ˆä¾‹ï¼šãƒ‘ã‚ºãƒ«ãŒå¥½ãã€ä½“ã‚’å‹•ã‹ã™ã®ãŒå¥½ãã€ãªã©ï¼‰");
        return;
      }

      // UIã®ãƒªã‚»ãƒƒãƒˆ
      document.getElementById('results').innerHTML = "";
      document.getElementById('loading').classList.remove('hidden');

      // Fetch APIã‚’ä½¿ã£ã¦GASã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
      try {
        if (API_URL.includes("ã“ã“ã«_GAS")) {
          throw new Error("API URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«å†…ã® API_URL ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚");
        }

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½œæˆ
        const url = `${API_URL}?age=${encodeURIComponent(age)}&gender=${encodeURIComponent(gender)}&traits=${encodeURIComponent(traits)}`;
        
        // ãƒ‡ãƒ¼ã‚¿å–å¾—
        const response = await fetch(url, {
          method: "GET",
          headers: { "Content-Type": "text/plain" },
        });

        const data = await response.json();
        
        // GASå´ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
        if (data.error) {
          showError({ message: data.error });
        } else {
          showResults(data);
        }

      } catch (error) {
        showError(error);
      }
    }

    // çµæœè¡¨ç¤ºé–¢æ•°
    function showResults(data) {
      document.getElementById('loading').classList.add('hidden');
      const container = document.getElementById('results');

      if (!data || data.length === 0) {
        container.innerHTML = `
          <div class="text-center p-8 bg-white rounded-xl border border-dashed border-gray-300">
            <p class="text-gray-500">æ¡ä»¶ã«åˆã†å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ç‰¹æ€§ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
          </div>`;
        return;
      }

      let html = "";
      data.forEach(item => {
        html += `
          <div class="bg-white rounded-2xl shadow-md overflow-hidden flex flex-col md:flex-row border border-gray-100 hover:shadow-xl transition duration-300 transform hover:-translate-y-1">
            <div class="md:w-1/3 bg-gray-50 flex items-center justify-center p-4">
              <img src="${item.imageUrl}" alt="${item.productName}" class="max-h-48 object-contain mix-blend-multiply">
            </div>
            <div class="p-6 md:w-2/3 flex flex-col justify-between">
              <div>
                <div class="flex items-center gap-2 mb-2">
                   <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">Keyword: ${item.keyword}</span>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2 leading-tight line-clamp-2">${item.productName}</h3>
                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 text-sm text-gray-700 mb-4">
                  <span class="font-bold text-orange-500">ğŸ’¡ ãŠã™ã™ã‚ç†ç”±:</span><br>
                  ${item.reason}
                </div>
              </div>
              <div class="flex items-center justify-between mt-2 pt-4 border-t border-gray-100">
                <span class="text-xl font-bold text-red-500">${item.price}</span>
                <a href="${item.itemUrl}" target="_blank" class="bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white font-bold py-2 px-6 rounded-full shadow transition flex items-center gap-1">
                  æ¥½å¤©ã§è¦‹ã‚‹ <span>â†—</span>
                </a>
              </div>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
    function showError(error) {
      document.getElementById('loading').classList.add('hidden');
      alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
      console.error(error);
    }
  </script>
</body>
</html>
